box: elixir:1.7.3

services:
  services:
    - id: postgres
      env:
        POSTGRES_PASSWORD: postgres
        POSTGRES_USER: postgres

build:
  steps:
    - script:
      name: setup system
      code: |
        export MIX_ENV=ci
        apt-get update
        apt-get install -y build-essential

    - bigtruedata/install-node:
      version: 8.14.0

    - script:
      name: setup mix
      code: |
        mix local.hex --force
        mix deps.get --force
        mix local.rebar --force

    - script:
      name: lint test
      code: mix format --check-formatted

    - script:
      name: background test
      code: mix test
